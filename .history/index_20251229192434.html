<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Fantasy Auction Dashboard</title>

<style>
body {
  font-family: Arial;
  background:#f4f6f8;
  padding:20px;
}

h1 { margin-bottom: 6px; }

.summary {
  background: white;
  padding: 12px;
  margin-bottom: 20px;
  border-left: 6px solid #111;
  font-size: 16px;
}

.filters input {
  padding:6px;
  margin-right:10px;
  width: 200px;
}

.table-container {
  overflow-x:auto;
  background:white;
}

table {
  width:100%;
  border-collapse:collapse;
}

th, td {
  border:1px solid #ccc;
  padding:6px;
  text-align:center;
  white-space: nowrap;
}

th {
  background:#111;
  color:white;
  position: sticky;
  top: 0;
  z-index: 2;
}

/* Sticky PLAYER column */
.sticky-player {
  position: sticky;
  left: 0;
  background: #fff;
  font-weight: bold;
  z-index: 3;
}

.sticky-player-header {
  position: sticky;
  left: 0;
  background: #111;
  z-index: 4;
}
</style>
</head>

<body>

<h1>üèè Fantasy Auction Dashboard</h1>

<div class="summary">
  <strong>Matches Completed:</strong> {{MATCHES_COMPLETED}}
</div>

<h2>Team Rankings</h2>
<table>
<thead>
<tr><th>Rank</th><th>Team</th><th>Points</th></tr>
</thead>
<tbody id="rankBody"></tbody>
</table>

<h2>Player Match-wise Points</h2>

<div class="filters">
  <input id="matchFilter" placeholder="Filter Match ID">
  <input id="playerFilter" placeholder="Filter Player">
  <input id="teamFilter" placeholder="Filter Auction Team">
</div>

<div class="table-container">
<table>
  <thead id="pointsHead"></thead>
  <tbody id="pointsBody"></tbody>
</table>
</div>

<script>
const rankData = {{RANK_DATA}} || [];
const pointsData = {{POINTS_DATA}} || [];

/* ---------- RANK TABLE ---------- */
rankBody.innerHTML = rankData.map(r =>
  `<tr>
    <td>${r.rank}</td>
    <td>${r.teams}</td>
    <td>${r.points}</td>
  </tr>`
).join("");

/* ---------- COLUMN ORDER (FIXED) ---------- */
function getOrderedColumns(row) {
  const fixed = ["match_id", "player", "auction_team", "total_points"];
  const others = Object.keys(row).filter(
    k => !fixed.includes(k)
  );
  return fixed.concat(others);
}

/* ---------- BUILD TABLE ---------- */
function buildTable(data) {
  if (data.length === 0) {
    pointsHead.innerHTML = "";
    pointsBody.innerHTML = "<tr><td>No data</td></tr>";
    return;
  }

  const columns = getOrderedColumns(data[0]);

  /* Header */
  pointsHead.innerHTML =
    "<tr>" +
    columns.map(col =>
      col === "player"
        ? `<th class="sticky-player-header">${col}</th>`
        : `<th>${col}</th>`
    ).join("") +
    "</tr>";

  /* Rows */
  pointsBody.innerHTML = data.map(row =>
    "<tr>" +
    columns.map(col =>
      col === "player"
        ? `<td class="sticky-player">${row[col]}</td>`
        : `<td>${row[col]}</td>`
    ).join("") +
    "</tr>"
  ).join("");
}

/* ---------- FILTERS ---------- */
function applyFilters() {
  const m = matchFilter.value.toLowerCase();
  const p = playerFilter.value.toLowerCase();
  const t = teamFilter.value.toLowerCase();

  const filtered = pointsData.filter(r =>
    String(r.match_id).toLowerCase().includes(m) &&
    String(r.player).toLowerCase().includes(p) &&
    String(r.auction_team).toLowerCase().includes(t)
  );

  buildTable(filtered);
}

matchFilter.oninput = applyFilters;
playerFilter.oninput = applyFilters;
teamFilter.oninput = applyFilters;

/* ---------- INITIAL LOAD ---------- */
buildTable(pointsData);
</script>

</body>
</html>
